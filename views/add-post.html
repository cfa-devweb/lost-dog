{% extends "layouts/base.html" %}

{% block css %}
<style>
    .aligneVertical {
        align-self: center;
    }

    .preview {
        max-width: 195px;
        max-height: 195px;
        display: block;
    }

    #file {
        display: none;
        width: auto;
        margin-left: 25%;
        margin-right: 25%;
        word-wrap: break-word;
    }

    .border-bottomUnique {
        border-bottom-color: #F5E400 !important;
    }

    .itemCenter {
        align-items: center;
    }

    @media only screen and (max-width: 991px) {
        .textAligneLeft {
            text-align: left !important;
        }
    }

    /* #F5E400 couleur logo */
</style>
{% endblock %}

{% block content %}


<main>


    <form class="container " action="post">
        <div class=" row">
            <div class="col-lg-12">
                <div class="row mt-4">
                    <div class="container">
                        <h2 class="text-center text-capitalize border-2 border-bottom border-secondary pb-4 font-title">
                            ajouter une annonce</h2>
                    </div>
                    <div class="container mt-4">
                        <p class="text-muted font-default">N'hésitai pas à donner le plus possible d'informations
                            concernant l'animal
                        </p>
                    </div>
                    <div class="col-lg-8">
                        <legend class="border-bottom border-bottomUnique mb-3  font-default">Informations
                            de l'animal
                        </legend>
                        <!-- Type de animal -->
                        <div class="form-group">
                            <div class="row">
                                <div class="col-lg-4 text-right textAligneLeft">
                                    <label for="ftype-animal" class="font-default ">Animal</label>
                                </div>
                                <div class="col-lg-8">
                                    <select class="form-control mb-3" id="ftype-animal">
                                        <option value="" class="font-default">--Choisi ton option--</option>
                                        <option value="dog" class="font-default">Chien</option>
                                        <option value="cat" class="font-default">Chat</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <!-- situation de animal -->
                        <div class="form-group">
                            <div class="row">
                                <div class="col-lg-4 text-right textAligneLeft">
                                    <label for="fsituation-animal" class="font-default ">Situation</label>
                                </div>
                                <div class="col-lg-8">
                                    <select class="form-control mb-3" id="fsituation-animal" required>
                                        <option value="" class="font-default">--Choisi ton option--</option>
                                        <option value="lost" class=" font-default">Perdu</option>
                                        <option value="found" class=" font-default">Trouver</option>
                                        <option value="adopted" class=" font-default">
                                            Adopter</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <!-- Sex de animal -->
                        <div class="form-group">
                            <div class="row">
                                <div class="col-lg-4 text-right textAligneLeft">
                                    <label for="fsex-animal" class="font-default ">Sex</label>
                                </div>
                                <div class="col-lg-8">
                                    <select class="form-control mb-3" id="fsex-animal">
                                        <option value="" class="font-default">--Choisi ton option--</option>
                                        <option value="male" class=" font-default">Male</option>
                                        <option value="female" class=" font-default">Femelle</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <legend class="border-bottom border-bottomUnique mb-3  font-default">Informations
                            personnel
                        </legend>
                        <div class="form-group">
                            <div class="row">
                                <div class="col-lg-4 text-right textAligneLeft">
                                    <label for="fnumber" class="font-default ">Numéro de
                                        téléphone</label>
                                </div>
                                <div class="col-lg-8">
                                    <input class="form-control mb-3" type="text" minlength="6" maxlength="6"
                                        id="numberPhone" required>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 aligneVertical">
                        <div class="container h-75">
                            <img src="images/icon-photo.png"
                                alt="cette image représente un appareil photo pour rajouter la photo d'un chien "
                                class="rounded mx-auto d-block" width="100">
                            <div class=" text-center">
                                <div>
                                    <h3 class=" font-default ">Photo principale</h3>
                                    <div class="text-capitalize font-default btn btn-primary " id="file">ajouter
                                        une
                                        photo</div>
                                    <div class="container">
                                        <input type="file" class="border border-dark border-1  w-100 upload"
                                            data-preview=".preview" id="fimage-animal" accept=".jpg, .jpeg, .png">

                                    </div>
                                    <img class="preview m-auto" />
                                    <small class="font-default">700ko max</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12 mb-4">
                <div class="form-group">
                    <label for="fcomentaire" class="font-default text-capitalize">description</label>
                    <textarea class="form-control mb-4" name="story" rows="5" cols="33" id="description"
                        required></textarea>
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-6"></div>
                            <div class="col-lg-6">
                                <div class="row">
                                    <div class="col-lg-7">
                                        <div class="custom-control custom-checkbox mb-2 d-flex itemCenter">
                                            <input type="checkbox" class="custom-control-input" id="defaultChecked2">
                                            <label class="custom-control-label" for="defaultChecked2"
                                                id="urgentDog "><small class="ml-2 font-default">Urgent! Cet animal
                                                    risque d'être
                                                    euthanasié</small>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <input class="btn btn-primary mb-3" type="submit" value="Envoyer">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {{ captcha | safe }}
    </form>
</main>
{% endblock %}

{% block js %}

<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
    crossorigin="anonymous"></script>
<script type="text/javascript">
    // Calcule de la taile de l'image 
    $(document).on("change", ".upload", function () {
        files = this.files;
        size = files[0].size;
        //max size 50kb => 50*1000 1000141
        //500ko = 500070.5
        //700ko = 700100.5
        if (size > 700101) {
            alert("Veuillez téléverser moins de 1 700 ko de fichier");
            return false;
        }
        return true;
    });
    // reCapatcha Google
    function resRecaptcha(token) {
        var input = document.createElement('input');
        input.setAttribute('type', 'hidden');
        input.setAttribute('name', 'g-recaptcha-response');
        input.setAttribute('value', token);
        document.getElementsByTagName('form')[0].appendChild(input);
    }

    // Envoi des données aux Back-End
    $('form').submit(function (event) {
        event.preventDefault();
        $description = $('#description').val();
        $img = $('#fimage-animal').get(0).files;
        $image = $img[0].name;

        $('form').submit(function (event) {
            event.preventDefault();
            $.post('/annonce', {
                    description: $description,
                    image: $image
                }, function (data) {
                    // alert('Votre publication a bien été ajoutée');
                    console.log(data);
                },
                'json');
        })
    })
    // Animal type
    $("#ftype-animal")
        .on("mouseenter", function () {
            $(this).css({
                "background-color": "seashell",
                "font-weight": "bolder",
                "border-bottom": "2px solid #F5E400"
            });
        })
        .on("mouseleave", function () {
            var styles = {
                backgroundColor: "",
                fontWeight: "",
                borderBottom: ""
            };
            $(this).css(styles);
        });
    // Animal Situation
    $("#fsituation-animal")
        .on("mouseenter", function () {
            $(this).css({
                "background-color": "seashell",
                "font-weight": "bolder",
                "border-bottom": "2px solid #F5E400"
            });
        })
        .on("mouseleave", function () {
            var styles = {
                backgroundColor: "",
                fontWeight: "",
                borderBottom: ""
            };
            $(this).css(styles);
        });
    // Animal SEX
    $("#fsex-animal")
        .on("mouseenter", function () {
            $(this).css({
                "background-color": "seashell",
                "font-weight": "bolder",
                "border-bottom": "2px solid #F5E400"
            });
        })
        .on("mouseleave", function () {
            var styles = {
                backgroundColor: "",
                fontWeight: "",
                borderBottom: ""
            };
            $(this).css(styles);
        });
    // Number phone
    $("#numberPhone")
        .on("mouseenter", function () {
            $(this).css({
                "background-color": "seashell",
                "font-weight": "bolder",
                "border-bottom": "2px solid #F5E400"
            });
        })
        .on("mouseleave", function () {
            var styles = {
                backgroundColor: "",
                fontWeight: "",
                borderBottom: ""
            };
            $(this).css(styles);
        });
    // Description
    $("#description")
        .on("mouseenter", function () {
            $(this).css({
                "background-color": "seashell",
                "font-weight": "bolder",
                "border-bottom": "2px solid #F5E400"
            });
        })
        .on("mouseleave", function () {
            var styles = {
                backgroundColor: "",
                fontWeight: "",
                borderBottom: ""
            };
            $(this).css(styles);
        });
    // URGENCE
    // $(document).ready(function () {
    //         $('input[id="urgentDog"]').click(function () {
    //             if ($(this).prop("checked") == true) {
    //                 //Active un élément 
    //                 $('#urgentDog').val("OUI");
    //             } else if ($(this).prop("checked") == false) {
    //                 //Désactive un élément
    //                 $('#urgentDog').val("NON");
    //             }
    //         });
    //     });

    // Apercue de upload
    $("input[data-preview]").change(function () {
        var $input = $(this);
        var fileReader = new FileReader();
        fileReader.readAsDataURL(this.files[0]);
        fileReader.onload = function (fileEvent) {
            $($input.data('preview')).attr('src', fileEvent.target.result);
        };
    });

    // style upload
    var wrapper = $('<div />').css({
        height: 0,
        width: 0,
        'overflow': 'hidden'
    });
    var fileInput = $(':file').wrap(wrapper);

    fileInput.change(function () {
        $this = $(this);
        $('#file').text($this.val());
    })

    $('#file').click(function () {
        fileInput.click();
    }).show();

    $("#file").click(function () {
        $("p").css("color", "red");
    });
</script>
{% endblock %}